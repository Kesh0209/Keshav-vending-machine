{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Products - Smart Vending Machine</title>
<style>
body { 
    margin:0; 
    font-family:sans-serif; 
    background: radial-gradient(circle at center, #0b0c10, #1f2833); 
    color:#c5c6c7; 
}
h1 { 
    text-align:center; 
    color:#66fcf1; 
    margin-top:20px; 
}
.category-title { 
    text-align:center; 
    color:#45a29e; 
    font-size:1.5em; 
    margin:20px 0 10px 0; 
}
.products-container { 
    display:flex; 
    flex-wrap:wrap; 
    justify-content:center; 
    gap:20px; 
    margin:10px; 
}
.product { 
    background:#1f2833; 
    padding:15px; 
    border-radius:10px; 
    text-align:center; 
    width:150px; 
    box-shadow:0 0 10px #66fcf1; 
    cursor:pointer; 
    transition:transform 0.2s; 
}
.product:hover { 
    transform: scale(1.05); 
}
.product img { 
    width:100%; 
    height:120px;
    object-fit: cover;
    border-radius:10px; 
}
.product-info { 
    font-size:0.85em; 
    margin:5px 0; 
}
.qty-container { 
    display:flex; 
    justify-content:center; 
    align-items:center; 
    margin-top:5px; 
    gap:5px; 
}
.qty-container button { 
    background:#45a29e; 
    color:#0b0c10; 
    border:none; 
    padding:3px 6px; 
    border-radius:5px; 
    cursor:pointer; 
}
input.qty { 
    width:40px; 
    text-align:center; 
    border-radius:5px; 
    border:none; 
}
#checkout { 
    display:block; 
    margin:20px auto; 
    padding:10px 20px; 
    background:#66fcf1; 
    color:#0b0c10; 
    border:none; 
    border-radius:10px; 
    font-size:1em; 
    cursor:pointer; 
}
</style>
</head>
<body>

<h1>Welcome, {{ student_name }}! Select Products</h1>

<form method="post" action="{% url 'purchase' %}" id="cartForm">
    {% csrf_token %}
    <input type="hidden" name="cart_submitted" value="1">

    <!-- Snacks -->
    <div class="category-title">üç∞ Cakes & Snacks</div>
    <div class="products-container">
        {% for product in snacks %}
            <div class="product" data-id="{{ product.id }}" data-name="{{ product.product_name }}" data-price="{{ product.cost }}">
                {% if product.product_image %}
                <img src="{{ product.product_image.url }}" alt="{{ product.product_name }}">
                {% else %}
                <div style="width:100%; height:120px; background:#45a29e; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:2em;">
                    üç∞
                </div>
                {% endif %}
                <h3>{{ product.product_name }}</h3>
                <div class="product-info">ID: {{ product.id }}</div>
                <div class="product-info">Price: Rs {{ product.cost }}</div>
                <div class="product-info">Stock Left: {{ product.available_quantity }}</div>
                <div class="qty-container">
                    <button type="button" class="minus">-</button>
                    <input type="number" name="qty_{{ product.id }}" value="0" min="0" class="qty">
                    <button type="button" class="plus">+</button>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Drinks -->
    <div class="category-title">ü•§ Soft Drinks</div>
    <div class="products-container">
        {% for product in drinks %}
            <div class="product" data-id="{{ product.id }}" data-name="{{ product.product_name }}" data-price="{{ product.cost }}">
                {% if product.product_image %}
                <img src="{{ product.product_image.url }}" alt="{{ product.product_name }}">
                {% else %}
                <div style="width:100%; height:120px; background:#45a29e; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:2em;">
                    ü•§
                </div>
                {% endif %}
                <h3>{{ product.product_name }}</h3>
                <div class="product-info">ID: {{ product.id }}</div>
                <div class="product-info">Price: Rs {{ product.cost }}</div>
                <div class="product-info">Stock Left: {{ product.available_quantity }}</div>
                <div class="qty-container">
                    <button type="button" class="minus">-</button>
                    <input type="number" name="qty_{{ product.id }}" value="0" min="0" class="qty">
                    <button type="button" class="plus">+</button>
                </div>
            </div>
        {% endfor %}
    </div>

    <button type="submit" id="checkout">Proceed to Insert Money</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Increase qty with plus button
    document.querySelectorAll(".plus").forEach(function(btn) {
        btn.addEventListener("click", function(e) {
            e.stopPropagation();
            e.preventDefault();
            var input = this.parentNode.querySelector(".qty");
            input.value = parseInt(input.value || 0) + 1;
        });
    });

    // Decrease qty with minus button
    document.querySelectorAll(".minus").forEach(function(btn) {
        btn.addEventListener("click", function(e) {
            e.stopPropagation();
            e.preventDefault();
            var input = this.parentNode.querySelector(".qty");
            input.value = Math.max(0, parseInt(input.value || 0) - 1);
        });
    });

    // Clicking anywhere on product increments qty
    document.querySelectorAll(".product").forEach(function(prod) {
        prod.addEventListener("click", function(e) {
            if(e.target.tagName !== "BUTTON" && e.target.tagName !== "INPUT") {
                var input = this.querySelector(".qty");
                input.value = parseInt(input.value || 0) + 1;
            }
        });
    });
});
</script>

</body>
</html>



















